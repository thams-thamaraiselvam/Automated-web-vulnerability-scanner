#!/bin/bash

# Ensure the script is run with root privileges
if [ "$(id -u)" -ne "0" ]; then
    echo "This script must be run as root or with sudo." 1>&2
    exit 1
fi

# Check if the required tools are installed
for tool in nmap nikto gobuster wpscan; do
    if ! command -v $tool &> /dev/null; then
        echo "$tool is not installed. Please install $tool before running this script." 1>&2
        exit 1
    fi
done

# Gather information from the user
read -p "Enter the URL of the web application to test (include http:// or https://): " url
output_dir="reports"

# Create output directory if it doesn't exist
mkdir -p "$output_dir"

# Define output file names
nmap_report="$output_dir/nmap_report.txt"
nikto_report="$output_dir/nikto_report.txt"
gobuster_report="$output_dir/gobuster_report.txt"
wpscan_report="$output_dir/wpscan_report.txt"
html_report="$output_dir/pentest_report.html"

# Function to perform Nmap scan
perform_nmap_scan() {
    echo "Performing Nmap scan..."
    nmap -A -T4 "$url" > "$nmap_report"
    echo "Nmap scan complete."
}

# Function to perform Nikto scan
perform_nikto_scan() {
    echo "Performing Nikto scan..."
    nikto -h "$url" -o "$nikto_report"
    echo "Nikto scan complete."
}

# Function to perform Gobuster scan
perform_gobuster_scan() {
    echo "Performing Gobuster scan..."
    gobuster dir -u "$url" -w /usr/share/wordlists/dirbuster/directory-list-2.3-small.txt -o "$gobuster_report"
    echo "Gobuster scan complete."
}

# Function to perform WPScan
perform_wpscan() {
    echo "Performing WPScan (if applicable)..."
    wpscan --url "$url" --output "$wpscan_report"
    echo "WPScan complete."
}

# Function to generate HTML report
generate_html_report() {
    echo "Generating HTML report..."

    cat <<EOF > "$html_report"
<!DOCTYPE html>
<html>
<head>
    <title>Web Application Penetration Test Report</title>
    <style>
        body { font-family: Arial, sans-serif; }
        h1 { color: #333; }
        pre { background: #f4f4f4; padding: 10px; border-radius: 5px; }
        .section { margin-bottom: 20px; }
    </style>
</head>
<body>
    <h1>Web Application Penetration Test Report</h1>

    <div class="section">
        <h2>Nmap Scan Results</h2>
        <pre>$(cat "$nmap_report")</pre>
    </div>

    <div class="section">
        <h2>Nikto Scan Results</h2>
        <pre>$(cat "$nikto_report")</pre>
    </div>

    <div class="section">
        <h2>Gobuster Results</h2>
        <pre>$(cat "$gobuster_report")</pre>
    </div>

    <div class="section">
        <h2>WPScan Results</h2>
        <pre>$(cat "$wpscan_report")</pre>
    </div>

</body>
</html>
EOF

    echo "HTML report generated at $html_report"
}

# Perform scans
perform_nmap_scan
perform_nikto_scan
perform_gobuster_scan
perform_wpscan

# Generate HTML report
generate_html_report

echo "Web application pentest complete. Results are saved in $output_dir."



